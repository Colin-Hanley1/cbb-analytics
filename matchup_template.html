<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matchup Simulator | CBB Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style> 
        body { font-family: 'Inter', sans-serif; } 
        /* Mobile menu transition state */
        #mobile-menu { display: none; }
        #mobile-menu.open { display: block; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen flex flex-col">

    <!-- NAVBAR -->
    <nav class="bg-slate-800 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Branding & Desktop Nav -->
                <div class="flex items-center">
                    <span class="font-bold text-xl tracking-tight text-white">CHan Analytics</span>
                    {{NAV_DESKTOP}}
                </div>
                
                <div class="flex items-center">
                    <!-- Update Time (Desktop) -->
                    <div class="hidden md:block text-xs text-slate-400 mr-4">
                        Updated: <span class="text-white">{{LAST_UPDATED}}</span>
                    </div>

                    <!-- Mobile Menu Button -->
                    <div class="-mr-2 flex md:hidden">
                        <button type="button" onclick="toggleMenu()" class="bg-slate-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-slate-700 focus:outline-none">
                            <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Mobile Menu Panel -->
        {{NAV_MOBILE}}
    </nav>

    <!-- CONTENT -->
    <main class="flex-grow max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
        
        <div class="mb-6 text-center sm:text-left">
            <h1 class="text-2xl sm:text-3xl font-bold text-slate-900">Matchup Simulator</h1>
            <p class="text-sm text-slate-500">Project spreads and totals based on adjusted efficiency.</p>
        </div>

        <!-- INPUTS GRID -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <!-- Team A -->
            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Home / Team A</label>
                <select id="teamA" class="block w-full p-3 border border-gray-300 bg-gray-50 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base sm:text-lg font-medium appearance-none" onchange="runSim()">
                    <option value="">Select Team...</option>
                </select>
                <div id="statsA" class="mt-3 flex justify-between text-xs text-gray-500 hidden font-mono">
                    <span>AdjO: <b id="valOA" class="text-slate-800"></b></span>
                    <span>AdjD: <b id="valDA" class="text-slate-800"></b></span>
                    <span>Tmp: <b id="valTA" class="text-slate-800"></b></span>
                </div>
            </div>

            <!-- Team B -->
            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Away / Team B</label>
                <select id="teamB" class="block w-full p-3 border border-gray-300 bg-gray-50 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base sm:text-lg font-medium appearance-none" onchange="runSim()">
                    <option value="">Select Team...</option>
                </select>
                <div id="statsB" class="mt-3 flex justify-between text-xs text-gray-500 hidden font-mono">
                    <span>AdjO: <b id="valOB" class="text-slate-800"></b></span>
                    <span>AdjD: <b id="valDB" class="text-slate-800"></b></span>
                    <span>Tmp: <b id="valTB" class="text-slate-800"></b></span>
                </div>
            </div>
        </div>

        <!-- LOCATION BUTTONS -->
        <div class="flex justify-center mb-8">
            <div class="inline-flex rounded-lg shadow-sm w-full sm:w-auto" role="group">
                <button type="button" onclick="setLoc('Home')" id="btnHome" class="flex-1 sm:flex-none px-6 py-3 text-sm font-medium text-white bg-blue-600 border border-blue-600 rounded-l-lg hover:bg-blue-700 transition-colors">Home</button>
                <button type="button" onclick="setLoc('Neutral')" id="btnNeutral" class="flex-1 sm:flex-none px-6 py-3 text-sm font-medium text-gray-700 bg-white border-t border-b border-gray-300 hover:bg-gray-50 transition-colors">Neutral</button>
                <button type="button" onclick="setLoc('Away')" id="btnAway" class="flex-1 sm:flex-none px-6 py-3 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-50 transition-colors">Away</button>
            </div>
        </div>

        <!-- SCOREBOARD -->
        <div id="scoreboard" class="hidden bg-slate-800 text-white rounded-2xl shadow-xl overflow-hidden transform transition-all duration-300">
            <div class="p-6 sm:p-8 text-center">
                <div class="text-[10px] font-bold text-blue-400 uppercase tracking-widest mb-4">Projected Result</div>
                
                <!-- Scores -->
                <div class="flex justify-center items-center space-x-4 sm:space-x-12 mb-8">
                    <div class="text-center w-1/3">
                        <div class="text-4xl sm:text-6xl font-bold tracking-tighter" id="scoreA">--</div>
                        <div class="text-xs sm:text-sm text-slate-400 font-medium mt-1 truncate max-w-[100px] sm:max-w-[150px] mx-auto" id="nameA">Team A</div>
                    </div>
                    <div class="text-xl sm:text-3xl text-slate-600 font-light pb-4">-</div>
                    <div class="text-center w-1/3">
                        <div class="text-4xl sm:text-6xl font-bold tracking-tighter" id="scoreB">--</div>
                        <div class="text-xs sm:text-sm text-slate-400 font-medium mt-1 truncate max-w-[100px] sm:max-w-[150px] mx-auto" id="nameB">Team B</div>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-3 gap-2 sm:gap-6 border-t border-slate-700 pt-6">
                    <div class="bg-slate-700/30 rounded-lg p-2">
                        <div class="text-[10px] sm:text-xs text-slate-400 uppercase tracking-wider mb-1">Spread</div>
                        <div class="text-sm sm:text-xl font-bold text-white" id="spread">--</div>
                    </div>
                    <div class="bg-slate-700/30 rounded-lg p-2">
                        <div class="text-[10px] sm:text-xs text-slate-400 uppercase tracking-wider mb-1">Total</div>
                        <div class="text-sm sm:text-xl font-bold text-white" id="total">--</div>
                    </div>
                    <div class="bg-slate-700/30 rounded-lg p-2">
                        <div class="text-[10px] sm:text-xs text-slate-400 uppercase tracking-wider mb-1">Win %</div>
                        <div class="text-sm sm:text-xl font-bold text-green-400" id="winProb">--</div>
                    </div>
                </div>
                
                <div class="mt-4 text-[10px] text-slate-500">
                    Est. Possessions: <span id="pace">--</span>
                </div>
            </div>
        </div>

    </main>

    <footer class="bg-white border-t border-gray-200 mt-auto py-6">
        <div class="max-w-6xl mx-auto px-4 text-center text-slate-400 text-xs">
            Automated Analysis System
        </div>
    </footer>

    <script>
        // Data injected by build_site.py
        const teams = {{TEAMS_JSON}};
        
        // Constants
        const AVG_EFF = 106.0;
        const AVG_TEMPO = 68.5;
        const HFA = 3.2;
        let locState = 'Home';

        // Mobile Menu Toggle
        function toggleMenu() {
            document.getElementById('mobile-menu').classList.toggle('open');
        }

        // Initialize Dropdowns
        window.onload = function() {
            const selA = document.getElementById('teamA');
            const selB = document.getElementById('teamB');
            // Sort teams alphabetically
            const sortedTeams = Object.keys(teams).sort();
            sortedTeams.forEach(t => {
                selA.add(new Option(t, t));
                selB.add(new Option(t, t));
            });
        };

        function setLoc(loc) {
            locState = loc;
            
            // Simplified styling logic
            const baseClass = "flex-1 sm:flex-none px-6 py-3 text-sm font-medium transition-colors border";
            const activeClass = "text-white bg-blue-600 border-blue-600 hover:bg-blue-700 z-10";
            const inactiveClass = "text-gray-700 bg-white border-gray-300 hover:bg-gray-50";
            
            ['Home', 'Neutral', 'Away'].forEach(l => {
                const btn = document.getElementById('btn'+l);
                let rounded = "";
                if(l === 'Home') rounded = "rounded-l-lg";
                else if(l === 'Away') rounded = "rounded-r-lg";
                else rounded = "border-l-0 border-r-0"; // Middle button border fix

                if(l === loc) btn.className = `${baseClass} ${activeClass} ${rounded}`;
                else btn.className = `${baseClass} ${inactiveClass} ${rounded}`;
            });
            runSim();
        }

        function runSim() {
            const nameA = document.getElementById('teamA').value;
            const nameB = document.getElementById('teamB').value;
            if(!nameA || !nameB) return;

            const A = teams[nameA];
            const B = teams[nameB];

            // Update Stats Display
            document.getElementById('statsA').classList.remove('hidden');
            document.getElementById('valOA').innerText = A.AdjO.toFixed(1);
            document.getElementById('valDA').innerText = A.AdjD.toFixed(1);
            document.getElementById('valTA').innerText = A.AdjT.toFixed(1);

            document.getElementById('statsB').classList.remove('hidden');
            document.getElementById('valOB').innerText = B.AdjO.toFixed(1);
            document.getElementById('valDB').innerText = B.AdjD.toFixed(1);
            document.getElementById('valTB').innerText = B.AdjT.toFixed(1);

            // --- MATH ---
            let hfaAdj = 0;
            if(locState === 'Home') hfaAdj = HFA;
            else if(locState === 'Away') hfaAdj = -HFA;

            const expEffA = A.AdjO + B.AdjD - AVG_EFF + hfaAdj;
            const expEffB = B.AdjO + A.AdjD - AVG_EFF - hfaAdj;
            const expTempo = A.AdjT + B.AdjT - AVG_TEMPO;

            const scoreA = (expEffA * expTempo) / 100;
            const scoreB = (expEffB * expTempo) / 100;

            const spreadVal = scoreB - scoreA;
            const totalVal = scoreA + scoreB;
            
            // Pythagenport Win %
            const x = 11.5;
            const wpA = (Math.pow(scoreA, x)) / (Math.pow(scoreA, x) + Math.pow(scoreB, x));

            // --- DISPLAY ---
            document.getElementById('scoreboard').classList.remove('hidden');
            
            document.getElementById('nameA').innerText = nameA;
            document.getElementById('nameB').innerText = nameB;
            document.getElementById('scoreA').innerText = Math.round(scoreA);
            document.getElementById('scoreB').innerText = Math.round(scoreB);
            
            // Spread Logic: If ScoreB > ScoreA, Spread is + (B is favored). 
            // We want to show the favored team.
            let spreadText = "Pick";
            if (Math.abs(spreadVal) >= 0.1) {
                if (scoreA > scoreB) {
                    spreadText = `${nameA} -${Math.abs(spreadVal).toFixed(1)}`;
                } else {
                    spreadText = `${nameB} -${Math.abs(spreadVal).toFixed(1)}`;
                }
            }
            
            document.getElementById('spread').innerText = spreadText;
            document.getElementById('total').innerText = totalVal.toFixed(1);
            document.getElementById('winProb').innerText = (wpA * 100).toFixed(1) + "%";
            document.getElementById('pace').innerText = expTempo.toFixed(1);
        }
    </script>
</body>
</html>