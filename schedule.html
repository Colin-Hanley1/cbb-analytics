<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Today's Games | CHan Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: { 500: '#6366f1', 600: '#4f46e5', 900: '#312e81' }
                    }
                }
            }
        }
    </script>
    <style> 
        body { -webkit-font-smoothing: antialiased; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        #mobile-menu { display: none; transition: all 0.3s; }
        #mobile-menu.open { display: block; }

        /* Enables smooth scrolling for hash navigation too */
        html { scroll-behavior: smooth; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col selection:bg-brand-500 selection:text-white">

    <!-- Navbar -->
    <nav class="bg-slate-900/95 backdrop-blur-md text-white shadow-lg sticky top-0 z-50 border-b border-slate-700/50" id="siteNav">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <!-- Use href="#topTableAnchor" for accessibility, but we handle offset in JS -->
                    <a href="#topTableAnchor" onclick="scrollToTableTop(event)" class="flex items-center">
                        <img
                          src="wlogo.png"
                          alt="CHan Analytics"
                          class="h-6 sm:h-7 w-auto object-contain select-none"
                          style="max-height: 28px"
                        />
                      </a>
                    <div class="hidden md:flex ml-8 space-x-1">
                        <div class="hidden md:block"><div class="ml-10 flex items-baseline space-x-4"><a href="index.html" class="text-gray-300 hover:bg-slate-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Rankings</a><a href="schedule.html" class="bg-slate-900 text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Today's Games</a><a href="matchup.html" class="text-gray-300 hover:bg-slate-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Matchup Simulator</a><a href="bracketology.html" class="text-gray-300 hover:bg-slate-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Bracketology</a></div></div>
                    </div>
                </div>
                
                <div class="flex items-center gap-4">
                    <div class="hidden md:block text-xs font-mono text-slate-400 bg-slate-800 px-3 py-1.5 rounded-full border border-slate-700">
                        <span class="text-brand-500">●</span> Updated: <span class="text-slate-200">2026-01-24 12:43 UTC</span>
                    </div>
                    <div class="-mr-2 flex md:hidden">
                        <button type="button" onclick="toggleMenu()" class="text-slate-400 hover:text-white p-2">
                            <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="md:hidden" id="mobile-menu"><div class="px-2 pt-2 pb-3 space-y-1 sm:px-3"><a href="index.html" class="text-gray-300 hover:bg-slate-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Rankings</a><a href="schedule.html" class="bg-slate-900 text-white block px-3 py-2 rounded-md text-base font-medium">Today's Games</a><a href="matchup.html" class="text-gray-300 hover:bg-slate-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Matchup Simulator</a><a href="bracketology.html" class="text-gray-300 hover:bg-slate-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Bracketology</a></div></div>
    </nav>

    <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Give the anchor a little scroll margin so it doesn't sit under the sticky nav -->
        <div id="topTableAnchor" style="scroll-margin-top: 88px;"></div>

        <!-- Header & Search -->
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
            <div>
                <h1 class="text-3xl font-bold text-slate-900 tracking-tight">Today's Slate</h1>
                <p class="text-sm text-slate-500 mt-1">Projected scores, spreads, and win probabilities.</p>
            </div>
            
            <div class="relative w-full sm:w-72 group">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-500">
                    <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <input type="text" id="scheduleSearch" onkeyup="filterSchedule()" placeholder="Find a game..." 
                    class="block w-full pl-10 pr-3 py-2 border border-slate-200 rounded-lg bg-white focus:ring-2 focus:ring-brand-500 focus:border-brand-500 sm:text-sm shadow-sm transition-all">
            </div>
        </div>

        <!-- Table Card -->
        <div class="bg-white shadow-xl shadow-slate-200/50 rounded-2xl overflow-hidden border border-slate-200">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse whitespace-nowrap text-sm" id="scheduleTable">
                    <thead class="bg-slate-50 border-b border-slate-200 text-xs uppercase tracking-wider text-slate-500 font-bold">
                        <tr>
                            <th class="px-6 py-4">Home Team</th>
                            <th class="px-2 py-4 text-center text-slate-300 font-light">vs</th>
                            <th class="px-6 py-4">Away Team</th>
                            <th class="px-6 py-4 text-right">Home Score</th>
                            <th class="px-6 py-4 text-right">Away Score</th>
                            <th class="px-6 py-4 text-right">Spread</th>
                            <th class="px-6 py-4 text-right">Win Prob</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100 bg-white" id="scheduleBody">
                        <!-- Rows injected by JS -->
                    </tbody>
                </table>
                
                <!-- Empty State -->
                <div id="noGamesMsg" class="hidden p-12 text-center text-slate-400">
                    <p class="font-medium text-lg">No games found.</p>
                    <p class="text-sm">Check back later or adjust your search.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Load Ratings Data -->
    <script src="teams_data.js"></script>

    <script>
        // --- Smooth scroll with sticky-nav offset ---
        function scrollToTableTop(e) {
            if (e) e.preventDefault();

            const anchor = document.getElementById('topTableAnchor');
            if (!anchor) return;

            const nav = document.getElementById('siteNav');
            const navH = nav ? nav.getBoundingClientRect().height : 0;

            // Extra padding so the header doesn’t feel glued to the nav
            const pad = 12;

            const y = anchor.getBoundingClientRect().top + window.pageYOffset - navH - pad;

            window.scrollTo({ top: Math.max(0, y), behavior: 'smooth' });

            // Keep URL clean (optional); if you want the hash, remove this line.
            history.replaceState(null, '', window.location.pathname);
        }

        // If the page loads with #topTableAnchor in the URL, apply offset scroll once.
        window.addEventListener('load', () => {
            if (window.location.hash === '#topTableAnchor') {
                // Defer to ensure layout is stable
                setTimeout(() => scrollToTableTop(), 0);
            }
        });

        // --- FIX IS HERE: Double Braces ---
        let games = [];
        try {
            games = [{"away": "West Virginia", "home": "Arizona"}, {"away": "Villanova", "home": "Connecticut"}, {"away": "Illinois", "home": "Purdue"}, {"away": "Wake Forest", "home": "Duke"}, {"away": "Houston", "home": "Texas Tech"}, {"away": "Nebraska", "home": "Minnesota"}, {"away": "San Francisco", "home": "Gonzaga"}, {"away": "Iowa St.", "home": "Oklahoma St."}, {"away": "Maryland", "home": "Michigan St."}, {"away": "Utah", "home": "BYU"}, {"away": "North Carolina", "home": "Virginia"}, {"away": "Vanderbilt", "home": "Mississippi St."}, {"away": "Auburn", "home": "Florida"}, {"away": "Tennessee", "home": "Alabama"}, {"away": "Clemson", "home": "Georgia Tech"}, {"away": "Kansas", "home": "Kansas St."}, {"away": "LSU", "home": "Arkansas"}, {"away": "Georgia", "home": "Texas"}, {"away": "Virginia Tech", "home": "Louisville"}, {"away": "Jackson St.", "home": "Bethune Cookman"}, {"away": "Vermont", "home": "Bryant"}, {"away": "Monmouth", "home": "Campbell"}, {"away": "Southern Mississippi", "home": "Coastal Carolina"}, {"away": "Boston University", "home": "Colgate"}, {"away": "Alcorn St.", "home": "Florida A&M"}, {"away": "UNC Wilmington", "home": "Hampton"}, {"away": "American", "home": "Holy Cross"}, {"away": "Drake", "home": "Indiana St."}, {"away": "Eastern Kentucky", "home": "Jacksonville"}, {"away": "Texas St.", "home": "James Madison"}, {"away": "Delaware", "home": "Liberty"}, {"away": "UMass Lowell", "home": "UMBC"}, {"away": "Albany", "home": "New Hampshire"}, {"away": "N.C. State", "home": "Pittsburgh"}, {"away": "Winthrop", "home": "Presbyterian"}, {"away": "Brown", "home": "Princeton"}, {"away": "Georgetown", "home": "Providence"}, {"away": "Green Bay", "home": "Robert Morris"}, {"away": "Dayton", "home": "Saint Joseph's"}, {"away": "Miami FL", "home": "Syracuse"}, {"away": "VMI", "home": "Western Carolina"}, {"away": "Mercer", "home": "Wofford"}, {"away": "TCU", "home": "Baylor"}, {"away": "Illinois Chicago", "home": "Bradley"}, {"away": "Texas A&M Corpus Chris", "home": "Incarnate Word"}, {"away": "Duquesne", "home": "Loyola Chicago"}, {"away": "New Orleans", "home": "McNeese"}, {"away": "Murray St.", "home": "Northern Iowa"}, {"away": "East Texas A&M", "home": "Northwestern St."}, {"away": "North Dakota St.", "home": "Oral Roberts"}, {"away": "Alabama St.", "home": "Prairie View A&M"}, {"away": "Western Kentucky", "home": "Sam Houston St."}, {"away": "Chattanooga", "home": "Samford"}, {"away": "Arkansas Pine Bluff", "home": "Southern"}, {"away": "Tennessee Tech", "home": "SIUE"}, {"away": "Temple", "home": "UTSA"}, {"away": "Alabama A&M", "home": "Texas Southern"}, {"away": "Memphis", "home": "Wichita St."}, {"away": "Cincinnati", "home": "Arizona St."}, {"away": "Air Force", "home": "Boise St."}, {"away": "UCF", "home": "Colorado"}, {"away": "Nevada", "home": "New Mexico"}, {"away": "FIU", "home": "New Mexico St."}, {"away": "San Jose St.", "home": "Wyoming"}, {"away": "Cal St. Fullerton", "home": "Cal Poly"}, {"away": "Grand Canyon", "home": "Fresno St."}, {"away": "Santa Clara", "home": "San Diego"}, {"away": "California", "home": "Stanford"}, {"away": "Northwestern", "home": "UCLA"}, {"away": "Pepperdine", "home": "Washington St."}, {"away": "Mississippi", "home": "Kentucky"}, {"away": "Niagara", "home": "Sacred Heart"}, {"away": "Illinois St.", "home": "Belmont"}, {"away": "Quinnipiac", "home": "Marist"}, {"away": "Army", "home": "Navy"}, {"away": "Northern Illinois", "home": "Ball St."}, {"away": "Columbia", "home": "Dartmouth"}, {"away": "Northeastern", "home": "Drexel"}, {"away": "Canisius", "home": "Fairfield"}, {"away": "Arkansas St.", "home": "Georgia St."}, {"away": "Cornell", "home": "Harvard"}, {"away": "Binghamton", "home": "Maine"}, {"away": "Oklahoma", "home": "Missouri"}, {"away": "Towson", "home": "North Carolina A&T"}, {"away": "Bellarmine", "home": "North Florida"}, {"away": "Yale", "home": "Penn"}, {"away": "George Mason", "home": "Rhode Island"}, {"away": "St. Thomas", "home": "South Dakota"}, {"away": "Hofstra", "home": "William & Mary"}, {"away": "St. John's", "home": "Xavier"}, {"away": "Milwaukee", "home": "Youngstown St."}, {"away": "Oakland", "home": "Detroit Mercy"}, {"away": "Kent St.", "home": "Eastern Michigan"}, {"away": "Richmond", "home": "George Washington"}, {"away": "Troy", "home": "Georgia Southern"}, {"away": "St. Peter's", "home": "Merrimack"}, {"away": "Eastern Illinois", "home": "Morehead St."}, {"away": "South Carolina", "home": "Texas A&M"}, {"away": "Elon", "home": "Charleston"}, {"away": "North Dakota", "home": "Denver"}, {"away": "UT Rio Grande Valley", "home": "Houston Christian"}, {"away": "Tennessee St.", "home": "Lindenwood"}, {"away": "South Alabama", "home": "Marshall"}, {"away": "San Diego St.", "home": "UNLV"}, {"away": "Coppin St.", "home": "Norfolk St."}, {"away": "Delaware St.", "home": "North Carolina Central"}, {"away": "Tulsa", "home": "Rice"}, {"away": "Maryland Eastern Shore", "home": "South Carolina St."}, {"away": "Nicholls", "home": "Southeastern Louisiana"}, {"away": "Florida St.", "home": "SMU"}, {"away": "Missouri St.", "home": "UTEP"}, {"away": "Queens", "home": "West Georgia"}, {"away": "UC Riverside", "home": "UC Davis"}, {"away": "VCU", "home": "Davidson"}, {"away": "Seton Hall", "home": "DePaul"}, {"away": "Sacramento St.", "home": "Eastern Washington"}, {"away": "Portland St.", "home": "Idaho"}, {"away": "Bucknell", "home": "Loyola MD"}, {"away": "Rider", "home": "Mount St. Mary's"}, {"away": "Bowling Green", "home": "Toledo"}, {"away": "Morgan St.", "home": "Howard"}, {"away": "Boston College", "home": "Notre Dame"}, {"away": "Central Michigan", "home": "Western Michigan"}, {"away": "Manhattan", "home": "Iona"}, {"away": "Stephen F. Austin", "home": "Lamar"}, {"away": "Lafayette", "home": "Lehigh"}, {"away": "UC Santa Barbara", "home": "Long Beach St."}, {"away": "Seattle", "home": "Pacific"}, {"away": "Northern Kentucky", "home": "Wright St."}, {"away": "Utah Valley", "home": "Cal Baptist"}, {"away": "Nebraska Omaha", "home": "Kansas City"}, {"away": "Weber St.", "home": "Montana St."}, {"away": "Northern Colorado", "home": "Northern Arizona"}, {"away": "Saint Mary's", "home": "Portland"}, {"away": "Southern Utah", "home": "Utah Tech"}, {"away": "Idaho St.", "home": "Montana"}, {"away": "UC Irvine", "home": "UC-San Diego"}];
        } catch (e) {
            console.error("Games JSON failed to load", e);
        }
        
        const tbody = document.getElementById('scheduleBody');
        const noGamesMsg = document.getElementById('noGamesMsg');
        
        const AVG_EFF = 106.0;
        const AVG_TEMPO = 68.5;
        const HFA = 3.2;

        function toggleMenu() {
            document.getElementById('mobile-menu').classList.toggle('open');
        }

        function renderSchedule() {
            if (!games || games.length === 0) {
                tbody.innerHTML = '';
                noGamesMsg.innerHTML = "<p>No games scheduled for today.</p>";
                noGamesMsg.classList.remove('hidden');
                return;
            }

            let rows = "";
            let gamesFound = false;

            // Safety check for TEAMS_DATA
            if (typeof TEAMS_DATA === 'undefined') {
                noGamesMsg.innerHTML = "<p class='text-rose-600 font-bold'>Error: Team Ratings data not loaded.</p>";
                noGamesMsg.classList.remove('hidden');
                return;
            }

            games.forEach(g => {
                const homeTeam = g.home;
                const awayTeam = g.away;
                
                const home = TEAMS_DATA[homeTeam];
                const away = TEAMS_DATA[awayTeam];

                if (!home || !away) return; 
                gamesFound = true;

                // Calc
                const expTempo = home.adjt + away.adjt - AVG_TEMPO;
                const expEffHome = (home.adjo + away.adjd - AVG_EFF) + HFA;
                const expEffAway = (away.adjo + home.adjd - AVG_EFF) - HFA;

                const rawScoreHome = (expEffHome * expTempo) / 100;
                const rawScoreAway = (expEffAway * expTempo) / 100;
                
                const scoreHome = Math.round(rawScoreHome);
                const scoreAway = Math.round(rawScoreAway);
                
                const margin = rawScoreHome - rawScoreAway;
                const spreadVal = Math.abs(margin).toFixed(1);
                
                let spreadDisplay = "Pick";
                if (Math.abs(margin) >= 0.1) {
                    const fav = margin > 0 ? homeTeam : awayTeam;
                    spreadDisplay = `${fav} -${spreadVal}`;
                }

                const x = 11.5;
                const wpHome = (Math.pow(rawScoreHome, x)) / (Math.pow(rawScoreHome, x) + Math.pow(rawScoreAway, x));
                const wpAway = 1 - wpHome;
                
                const winnerProb = margin > 0 ? wpHome : wpAway;
                const probDisplay = (winnerProb * 100).toFixed(1) + "%";
                const winnerName = margin > 0 ? homeTeam : awayTeam;
                
                // --- STYLING LOGIC ---
                const homeNameClass = margin > 0 ? "text-emerald-600 font-bold" : "text-red-600 font-medium";
                const awayNameClass = margin < 0 ? "text-emerald-600 font-bold" : "text-red-600 font-medium";
                
                // Scores: Winner gets color, Loser gets gray
                const homeScoreClass = margin > 0 ? "text-emerald-600 font-bold" : "text-red-600";
                const awayScoreClass = margin < 0 ? "text-emerald-600 font-bold" : "text-red-600";
                
                const spreadColor = "text-brand-600"; 
                const probColor = "text-slate-700";

                rows += `
                <tr class="hover:bg-slate-50 transition-colors group border-b border-slate-50">
                    <!-- Home Team -->
                    <td class="px-6 py-4 border-r border-slate-100/50">
                        <a href="team.html?q=${encodeURIComponent(homeTeam)}" class="hover:text-brand-600 hover:underline decoration-2 underline-offset-2 ${homeNameClass} block">${homeTeam}</a>
                        <span class="text-[10px] text-slate-400 font-mono tracking-wide">#${home.rank}</span>
                    </td>
                    
                    <td class="px-2 py-4 text-center text-xs text-slate-300 font-bold">vs</td>
                    
                    <!-- Away Team -->
                    <td class="px-6 py-4 border-l border-slate-100/50">
                        <a href="team.html?q=${encodeURIComponent(awayTeam)}" class="hover:text-brand-600 hover:underline decoration-2 underline-offset-2 ${awayNameClass} block">${awayTeam}</a>
                        <span class="text-[10px] text-slate-400 font-mono tracking-wide">#${away.rank}</span>
                    </td>

                    <!-- Scores -->
                    <td class="px-6 py-4 text-right font-mono text-base ${homeScoreClass} border-l border-slate-100/50">${scoreHome}</td>
                    <td class="px-6 py-4 text-right font-mono text-base ${awayScoreClass}">${scoreAway}</td>
                    
                    <!-- Stats -->
                    <td class="px-6 py-4 text-right font-bold ${spreadColor} text-sm font-mono border-l border-slate-100">${spreadDisplay}</td>
                    <td class="px-6 py-4 text-right">
                        <div class="font-mono ${probColor} font-bold">${probDisplay}</div>
                        <div class="text-[10px] text-slate-400 font-medium uppercase tracking-wide">${winnerName}</div>
                    </td>
                </tr>
                `;
            });
            
            if (!gamesFound) {
                 tbody.innerHTML = "";
                 noGamesMsg.innerText = "Schedule loaded, but matched team ratings not found.";
                 noGamesMsg.classList.remove('hidden');
            } else {
                 tbody.innerHTML = rows;
                 noGamesMsg.classList.add('hidden');
            }
        }

        function filterSchedule() {
            const input = document.getElementById('scheduleSearch');
            const filter = input.value.toUpperCase();
            const table = document.getElementById('scheduleTable');
            const tr = table.getElementsByTagName('tr');
            let hasVisible = false;

            for (let i = 1; i < tr.length; i++) {
                const tdHome = tr[i].getElementsByTagName("td")[0];
                const tdAway = tr[i].getElementsByTagName("td")[2];
                
                if (tdAway || tdHome) {
                    const txtValueAway = tdAway.textContent || tdAway.innerText;
                    const txtValueHome = tdHome.textContent || tdHome.innerText;
                    
                    if (txtValueAway.toUpperCase().indexOf(filter) > -1 || txtValueHome.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                        hasVisible = true;
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
            
            const msg = document.getElementById('noGamesMsg');
            if (!hasVisible && tr.length > 1) {
                msg.innerText = "No teams found matching '" + input.value + "'";
                msg.classList.remove('hidden');
            } else {
                if (tr.length <= 1) { } 
                else { msg.classList.add('hidden'); }
            }
        }

        renderSchedule();
    </script>
</body>
</html>
