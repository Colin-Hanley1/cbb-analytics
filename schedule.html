<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Today's Games | CHan Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: { 500: '#6366f1', 600: '#4f46e5', 900: '#312e81' }
                    }
                }
            }
        }
    </script>
    <style> 
        body { -webkit-font-smoothing: antialiased; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        #mobile-menu { display: none; transition: all 0.3s; }
        #mobile-menu.open { display: block; }

        /* Enables smooth scrolling for hash navigation too */
        html { scroll-behavior: smooth; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col selection:bg-brand-500 selection:text-white">

    <!-- Navbar -->
    <nav class="bg-slate-900/95 backdrop-blur-md text-white shadow-lg sticky top-0 z-50 border-b border-slate-700/50" id="siteNav">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <!-- Use href="#topTableAnchor" for accessibility, but we handle offset in JS -->
                    <a href="#topTableAnchor" onclick="scrollToTableTop(event)" class="flex items-center">
                        <img
                          src="wlogo.png"
                          alt="CHan Analytics"
                          class="h-6 sm:h-7 w-auto object-contain select-none"
                          style="max-height: 28px"
                        />
                      </a>
                    <div class="hidden md:flex ml-8 space-x-1">
                        <div class="hidden md:block"><div class="ml-10 flex items-baseline space-x-4"><a href="index.html" class="text-gray-300 hover:bg-slate-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Rankings</a><a href="schedule.html" class="bg-slate-900 text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Today's Games</a><a href="matchup.html" class="text-gray-300 hover:bg-slate-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Matchup Simulator</a><a href="bracketology.html" class="text-gray-300 hover:bg-slate-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Bracketology</a><a href="conferences.html" class="text-gray-300 hover:bg-slate-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">Conferences</a></div></div>
                    </div>
                </div>
                
                <div class="flex items-center gap-4">
                    <div class="hidden md:block text-xs font-mono text-slate-400 bg-slate-800 px-3 py-1.5 rounded-full border border-slate-700">
                        <span class="text-brand-500">●</span> Updated: <span class="text-slate-200">2026-01-31 18:32 UTC</span>
                    </div>
                    <div class="-mr-2 flex md:hidden">
                        <button type="button" onclick="toggleMenu()" class="text-slate-400 hover:text-white p-2">
                            <svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="md:hidden" id="mobile-menu"><div class="px-2 pt-2 pb-3 space-y-1 sm:px-3"><a href="index.html" class="text-gray-300 hover:bg-slate-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Rankings</a><a href="schedule.html" class="bg-slate-900 text-white block px-3 py-2 rounded-md text-base font-medium">Today's Games</a><a href="matchup.html" class="text-gray-300 hover:bg-slate-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Matchup Simulator</a><a href="bracketology.html" class="text-gray-300 hover:bg-slate-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Bracketology</a><a href="conferences.html" class="text-gray-300 hover:bg-slate-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Conferences</a></div></div>
    </nav>

    <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Give the anchor a little scroll margin so it doesn't sit under the sticky nav -->
        <div id="topTableAnchor" style="scroll-margin-top: 88px;"></div>

        <!-- Header & Search -->
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
            <div>
                <h1 class="text-3xl font-bold text-slate-900 tracking-tight">Today's Slate</h1>
                <p class="text-sm text-slate-500 mt-1">Projected scores, spreads, and win probabilities.</p>
            </div>
            
            <div class="relative w-full sm:w-72 group">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400 group-focus-within:text-brand-500">
                    <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <input type="text" id="scheduleSearch" onkeyup="filterSchedule()" placeholder="Find a game..." 
                    class="block w-full pl-10 pr-3 py-2 border border-slate-200 rounded-lg bg-white focus:ring-2 focus:ring-brand-500 focus:border-brand-500 sm:text-sm shadow-sm transition-all">
            </div>
        </div>

        <!-- Table Card -->
        <div class="bg-white shadow-xl shadow-slate-200/50 rounded-2xl overflow-hidden border border-slate-200">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse whitespace-nowrap text-sm" id="scheduleTable">
                    <thead class="bg-slate-50 border-b border-slate-200 text-xs uppercase tracking-wider text-slate-500 font-bold">
                        <tr>
                            <th class="px-6 py-4">Home Team</th>
                            <th class="px-2 py-4 text-center text-slate-300 font-light">vs</th>
                            <th class="px-6 py-4">Away Team</th>
                            <th class="px-6 py-4 text-right">Home Score</th>
                            <th class="px-6 py-4 text-right">Away Score</th>
                            <th class="px-6 py-4 text-right">Spread</th>
                            <th class="px-6 py-4 text-right" onclick="handleSort('WinProb', this)">Win Prob</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100 bg-white" id="scheduleBody">
                        <!-- Rows injected by JS -->
                    </tbody>
                </table>
                
                <!-- Empty State -->
                <div id="noGamesMsg" class="hidden p-12 text-center text-slate-400">
                    <p class="font-medium text-lg">No games found.</p>
                    <p class="text-sm">Check back later or adjust your search.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Load Ratings Data -->
    <script src="teams_data.js"></script>

    <script src="teams_data.js"></script>

<script>
  // -----------------------
  // CONFIG / STATE
  // -----------------------
  const AVG_EFF = 106.0;
  const AVG_TEMPO = 68.5;
  const HFA = 3.2;

  let sortKey = "winProb";     // default sort: win prob (desc)
  let sortAsc = false;

  // --- Smooth scroll with sticky-nav offset ---
  function scrollToTableTop(e) {
    if (e) e.preventDefault();
    const anchor = document.getElementById("topTableAnchor");
    if (!anchor) return;

    const nav = document.getElementById("siteNav");
    const navH = nav ? nav.getBoundingClientRect().height : 0;
    const pad = 12;

    const y = anchor.getBoundingClientRect().top + window.pageYOffset - navH - pad;
    window.scrollTo({ top: Math.max(0, y), behavior: "smooth" });
    history.replaceState(null, "", window.location.pathname);
  }

  // Mobile menu (same logic you used elsewhere)
  function toggleMenu() {
    document.getElementById("mobile-menu")?.classList.toggle("open");
  }

  // If the page loads with #topTableAnchor in the URL, apply offset scroll once.
  window.addEventListener("load", () => {
    if (window.location.hash === "#topTableAnchor") {
      setTimeout(() => scrollToTableTop(), 0);
    }
  });

  // -----------------------
  // DATA
  // -----------------------
  let games = [];
  try {
    games = [{"away": "Arizona", "home": "Arizona St."}, {"away": "Connecticut", "home": "Creighton"}, {"away": "Duke", "home": "Virginia Tech"}, {"away": "Saint Mary's", "home": "Gonzaga"}, {"away": "Cincinnati", "home": "Houston"}, {"away": "Texas Tech", "home": "UCF"}, {"away": "BYU", "home": "Kansas"}, {"away": "Kentucky", "home": "Arkansas"}, {"away": "North Carolina", "home": "Georgia Tech"}, {"away": "Virginia", "home": "Boston College"}, {"away": "Mississippi", "home": "Vanderbilt"}, {"away": "SMU", "home": "Louisville"}, {"away": "Pittsburgh", "home": "Clemson"}, {"away": "Northern Illinois", "home": "Miami OH"}, {"away": "UMBC", "home": "Albany"}, {"away": "Holy Cross", "home": "Army"}, {"away": "Queens", "home": "Bellarmine"}, {"away": "Dartmouth", "home": "Brown"}, {"away": "New Hampshire", "home": "Bryant"}, {"away": "Boston University", "home": "Bucknell"}, {"away": "Bowling Green", "home": "Central Michigan"}, {"away": "UNC Greensboro", "home": "The Citadel"}, {"away": "Maryland Eastern Shore", "home": "Delaware St."}, {"away": "Stony Brook", "home": "Elon"}, {"away": "Stanford", "home": "Florida St."}, {"away": "Valparaiso", "home": "Indiana St."}, {"away": "Florida Gulf Coast", "home": "Jacksonville"}, {"away": "High Point", "home": "Longwood"}, {"away": "Eastern Michigan", "home": "Massachusetts"}, {"away": "VMI", "home": "Mercer"}, {"away": "California", "home": "Miami FL"}, {"away": "Radford", "home": "Presbyterian"}, {"away": "Davidson", "home": "Richmond"}, {"away": "New Haven", "home": "Saint Francis"}, {"away": "North Alabama", "home": "Stetson"}, {"away": "Notre Dame", "home": "Syracuse"}, {"away": "South Florida", "home": "Temple"}, {"away": "Ball St.", "home": "Toledo"}, {"away": "Hampton", "home": "Towson"}, {"away": "N.C. State", "home": "Wake Forest"}, {"away": "Austin Peay", "home": "West Georgia"}, {"away": "Baylor", "home": "West Virginia"}, {"away": "Samford", "home": "Western Carolina"}, {"away": "Southern", "home": "Alcorn St."}, {"away": "Murray St.", "home": "Belmont"}, {"away": "Bradley", "home": "Drake"}, {"away": "Grambling St.", "home": "Jackson St."}, {"away": "Western Kentucky", "home": "Middle Tennessee"}, {"away": "UAB", "home": "North Texas"}, {"away": "Evansville", "home": "Northern Iowa"}, {"away": "Texas Southern", "home": "Prairie View A&M"}, {"away": "Louisiana Tech", "home": "Sam Houston St."}, {"away": "Illinois Chicago", "home": "Southern Illinois"}, {"away": "James Madison", "home": "Southern Mississippi"}, {"away": "Little Rock", "home": "Tennessee Tech"}, {"away": "Cal Baptist", "home": "UT Arlington"}, {"away": "Appalachian St.", "home": "Troy"}, {"away": "Ohio St.", "home": "Wisconsin"}, {"away": "Fresno St.", "home": "Air Force"}, {"away": "Oklahoma St.", "home": "Utah"}, {"away": "Oregon St.", "home": "San Diego"}, {"away": "Pacific", "home": "San Francisco"}, {"away": "New Mexico", "home": "San Jose St."}, {"away": "Rutgers", "home": "USC"}, {"away": "Indiana", "home": "UCLA"}, {"away": "Portland", "home": "Washington St."}, {"away": "Georgetown", "home": "Butler"}, {"away": "Marquette", "home": "Seton Hall"}, {"away": "Campbell", "home": "William & Mary"}, {"away": "LIU", "home": "Central Connecticut"}, {"away": "Texas A&M", "home": "Georgia"}, {"away": "Robert Morris", "home": "Purdue Fort Wayne"}, {"away": "Stonehill", "home": "Le Moyne"}, {"away": "Fairleigh Dickinson", "home": "Wagner"}, {"away": "DePaul", "home": "Xavier"}, {"away": "Lafayette", "home": "American"}, {"away": "Ohio", "home": "Buffalo"}, {"away": "Gardner Webb", "home": "Charleston Southern"}, {"away": "Mercyhurst", "home": "Chicago St."}, {"away": "North Carolina A&T", "home": "Drexel"}, {"away": "Fordham", "home": "George Washington"}, {"away": "Saint Joseph's", "home": "La Salle"}, {"away": "Colgate", "home": "Lehigh"}, {"away": "Maine", "home": "UMass Lowell"}, {"away": "Hofstra", "home": "Monmouth"}, {"away": "Lipscomb", "home": "North Florida"}, {"away": "Charleston", "home": "Northeastern"}, {"away": "Texas", "home": "Oklahoma"}, {"away": "San Diego St.", "home": "Utah St."}, {"away": "UNC Asheville", "home": "Winthrop"}, {"away": "Marshall", "home": "Arkansas St."}, {"away": "Coastal Carolina", "home": "Louisiana Monroe"}, {"away": "Mississippi St.", "home": "Missouri"}, {"away": "Jacksonville St.", "home": "Missouri St."}, {"away": "Lindenwood", "home": "Morehead St."}, {"away": "Oral Roberts", "home": "South Dakota St."}, {"away": "Idaho St.", "home": "Weber St."}, {"away": "Southern Utah", "home": "Abilene Christian"}, {"away": "Bethune Cookman", "home": "Alabama St."}, {"away": "Eastern Kentucky", "home": "Central Arkansas"}, {"away": "Morgan St.", "home": "Coppin St."}, {"away": "Nebraska Omaha", "home": "Denver"}, {"away": "Southeast Missouri", "home": "Eastern Illinois"}, {"away": "Norfolk St.", "home": "Howard"}, {"away": "Georgia Southern", "home": "Louisiana"}, {"away": "Loyola MD", "home": "Navy"}, {"away": "Eastern Washington", "home": "Northern Colorado"}, {"away": "Houston Christian", "home": "Texas A&M Corpus Chris"}, {"away": "NJIT", "home": "Vermont"}, {"away": "Tennessee Martin", "home": "Western Illinois"}, {"away": "Florida A&M", "home": "Alabama A&M"}, {"away": "UT Rio Grande Valley", "home": "Incarnate Word"}, {"away": "New Mexico St.", "home": "Kennesaw St."}, {"away": "Montana St.", "home": "Portland St."}, {"away": "Utah Tech", "home": "Tarleton St."}, {"away": "Old Dominion", "home": "Texas St."}, {"away": "Princeton", "home": "Columbia"}, {"away": "Penn", "home": "Cornell"}, {"away": "Arkansas Pine Bluff", "home": "Mississippi Valley St."}, {"away": "Northwestern St.", "home": "New Orleans"}, {"away": "LSU", "home": "South Carolina"}, {"away": "North Dakota St.", "home": "South Dakota"}, {"away": "George Mason", "home": "St. Bonaventure"}, {"away": "Southeastern Louisiana", "home": "Stephen F. Austin"}, {"away": "Nicholls", "home": "East Texas A&M"}, {"away": "McNeese", "home": "Lamar"}, {"away": "Harvard", "home": "Yale"}, {"away": "UC-San Diego", "home": "CSUN"}, {"away": "Cal Poly", "home": "UC Riverside"}, {"away": "Idaho", "home": "Northern Arizona"}, {"away": "Washington", "home": "Northwestern"}, {"away": "Georgia St.", "home": "South Alabama"}, {"away": "SIUE", "home": "Southern Indiana"}, {"away": "Auburn", "home": "Tennessee"}, {"away": "UC Davis", "home": "Cal St. Bakersfield"}, {"away": "Cal St. Fullerton", "home": "UC Santa Barbara"}, {"away": "Hawaii", "home": "Long Beach St."}, {"away": "Santa Clara", "home": "Loyola Marymount"}, {"away": "Delaware", "home": "UTEP"}, {"away": "Colorado St.", "home": "Wyoming"}, {"away": "Montana", "home": "Sacramento St."}];
  } catch (e) {
    console.error("Games JSON failed to load", e);
  }

  const tbody = document.getElementById("scheduleBody");
  const noGamesMsg = document.getElementById("noGamesMsg");
  const table = document.getElementById("scheduleTable");

  // -----------------------
  // UTILS
  // -----------------------
  function safeNum(x, fb = 0) {
    const v = Number(x);
    return Number.isFinite(v) ? v : fb;
  }

  function cmp(a, b) {
    // numbers first
    const na = typeof a === "number" && Number.isFinite(a);
    const nb = typeof b === "number" && Number.isFinite(b);
    if (na && nb) return a - b;

    // strings
    return String(a).localeCompare(String(b));
  }

  function setSortIcon(th, active, asc) {
    // remove existing icons
    document.querySelectorAll("th[data-sort] .sortIcon").forEach(el => el.textContent = "↕");
    if (!active) return;
    const icon = th.querySelector(".sortIcon");
    if (icon) icon.textContent = asc ? "↑" : "↓";
  }

  // -----------------------
  // BUILD COMPUTED ROWS
  // -----------------------
  function computeRows() {
    if (!games || games.length === 0) return [];

    if (typeof TEAMS_DATA === "undefined") {
      noGamesMsg.innerHTML = "<p class='text-rose-600 font-bold'>Error: Team Ratings data not loaded.</p>";
      noGamesMsg.classList.remove("hidden");
      return [];
    }

    const out = [];

    for (const g of games) {
      const homeTeam = g.home;
      const awayTeam = g.away;

      const home = TEAMS_DATA[homeTeam];
      const away = TEAMS_DATA[awayTeam];
      if (!home || !away) continue;

      const expTempo = safeNum(home.adjt) + safeNum(away.adjt) - AVG_TEMPO;
      const expEffHome = (safeNum(home.adjo) + safeNum(away.adjd) - AVG_EFF) + HFA;
      const expEffAway = (safeNum(away.adjo) + safeNum(home.adjd) - AVG_EFF) - HFA;

      const rawHome = (expEffHome * expTempo) / 100;
      const rawAway = (expEffAway * expTempo) / 100;

      const scoreHome = Math.round(rawHome);
      const scoreAway = Math.round(rawAway);

      const margin = rawHome - rawAway; // >0 means home favored
      const absSpread = Math.abs(margin);

      const x = 11.5;
      const wpHome = (Math.pow(rawHome, x)) / (Math.pow(rawHome, x) + Math.pow(rawAway, x));
      const wpAway = 1 - wpHome;

      const winnerIsHome = margin > 0;
      const winnerName = winnerIsHome ? homeTeam : awayTeam;
      const winProb = winnerIsHome ? wpHome : wpAway; // probability of predicted winner

      out.push({
        homeTeam,
        awayTeam,
        homeRank: safeNum(home.rank, 999),
        awayRank: safeNum(away.rank, 999),
        scoreHome,
        scoreAway,
        margin,          // signed (home - away)
        spread: absSpread, // numeric, absolute spread
        winnerName,
        winProb,         // 0..1
      });
    }

    return out;
  }

  // -----------------------
  // SORT + RENDER
  // -----------------------
  function getSortedRows() {
    const rows = computeRows();

    rows.sort((a, b) => {
      const c = cmp(a[sortKey], b[sortKey]);
      return sortAsc ? c : -c;
    });

    return rows;
  }

  function renderSchedule() {
    const rowsArr = getSortedRows();

    if (!rowsArr || rowsArr.length === 0) {
      tbody.innerHTML = "";
      noGamesMsg.innerHTML = "<p>No games scheduled for today.</p>";
      noGamesMsg.classList.remove("hidden");
      return;
    }

    let rowsHTML = "";

    for (const r of rowsArr) {
      const homeNameClass = r.margin > 0 ? "text-emerald-600 font-bold" : "text-red-600 font-medium";
      const awayNameClass = r.margin < 0 ? "text-emerald-600 font-bold" : "text-red-600 font-medium";

      const homeScoreClass = r.margin > 0 ? "text-emerald-600 font-bold" : "text-red-600";
      const awayScoreClass = r.margin < 0 ? "text-emerald-600 font-bold" : "text-red-600";

      let spreadDisplay = "Pick";
      if (Math.abs(r.margin) >= 0.1) {
        const fav = r.margin > 0 ? r.homeTeam : r.awayTeam;
        spreadDisplay = `${fav} -${r.spread.toFixed(1)}`;
      }

      const probDisplay = (r.winProb * 100).toFixed(1) + "%";

      rowsHTML += `
        <tr class="hover:bg-slate-50 transition-colors group border-b border-slate-50">
          <td class="px-6 py-4 border-r border-slate-100/50">
            <a href="team.html?q=${encodeURIComponent(r.homeTeam)}"
               class="hover:text-brand-600 hover:underline decoration-2 underline-offset-2 ${homeNameClass} block">
              ${r.homeTeam}
            </a>
            <span class="text-[10px] text-slate-400 font-mono tracking-wide">#${r.homeRank}</span>
          </td>

          <td class="px-2 py-4 text-center text-xs text-slate-300 font-bold">vs</td>

          <td class="px-6 py-4 border-l border-slate-100/50">
            <a href="team.html?q=${encodeURIComponent(r.awayTeam)}"
               class="hover:text-brand-600 hover:underline decoration-2 underline-offset-2 ${awayNameClass} block">
              ${r.awayTeam}
            </a>
            <span class="text-[10px] text-slate-400 font-mono tracking-wide">#${r.awayRank}</span>
          </td>

          <td class="px-6 py-4 text-right font-mono text-base ${homeScoreClass} border-l border-slate-100/50">${r.scoreHome}</td>
          <td class="px-6 py-4 text-right font-mono text-base ${awayScoreClass}">${r.scoreAway}</td>

          <td class="px-6 py-4 text-right font-bold text-brand-600 text-sm font-mono border-l border-slate-100">${spreadDisplay}</td>

          <td class="px-6 py-4 text-right">
            <div class="font-mono text-slate-700 font-bold">${probDisplay}</div>
            <div class="text-[10px] text-slate-400 font-medium uppercase tracking-wide">${r.winnerName}</div>
          </td>
        </tr>
      `;
    }

    tbody.innerHTML = rowsHTML;
    noGamesMsg.classList.add("hidden");
  }

  // -----------------------
  // SORT HANDLER
  // -----------------------
  function handleSort(key, th) {
    if (sortKey === key) sortAsc = !sortAsc;
    else {
      sortKey = key;
      // default directions
      const preferAsc = new Set(["homeTeam", "awayTeam", "scoreHome", "scoreAway"]);
      sortAsc = preferAsc.has(key);
      // usually want larger winProb/spread first
      if (key === "winProb" || key === "spread") sortAsc = false;
    }

    // update icon
    setSortIcon(th, true, sortAsc);
    renderSchedule();
  }

  // Attach listeners to headers (and add icons)
  (function initSorting() {
    // mark columns as sortable + add icon span
    const map = {
      homeTeam: 0,
      awayTeam: 2,
      scoreHome: 3,
      scoreAway: 4,
      spread: 5,
      winProb: 6,
    };

    const ths = table.querySelectorAll("thead th");
    Object.keys(map).forEach(key => {
      const idx = map[key];
      const th = ths[idx];
      if (!th) return;

      th.style.cursor = "pointer";
      th.classList.add("select-none");
      th.setAttribute("data-sort", key);

      // add an icon if missing
      if (!th.querySelector(".sortIcon")) {
        th.innerHTML = `${th.innerHTML} <span class="ml-1 text-slate-300 sortIcon">↕</span>`;
      }

      th.addEventListener("click", () => handleSort(key, th));
    });

    // initial icon state
    const th = table.querySelector(`th[data-sort="${sortKey}"]`);
    if (th) setSortIcon(th, true, sortAsc);
  })();

  // -----------------------
  // SEARCH FILTER (unchanged)
  // -----------------------
  function filterSchedule() {
    const input = document.getElementById("scheduleSearch");
    const filter = input.value.toUpperCase();
    const tr = table.getElementsByTagName("tr");
    let hasVisible = false;

    for (let i = 1; i < tr.length; i++) {
      const tdHome = tr[i].getElementsByTagName("td")[0];
      const tdAway = tr[i].getElementsByTagName("td")[2];

      if (tdAway || tdHome) {
        const txtAway = tdAway.textContent || tdAway.innerText;
        const txtHome = tdHome.textContent || tdHome.innerText;

        if (txtAway.toUpperCase().includes(filter) || txtHome.toUpperCase().includes(filter)) {
          tr[i].style.display = "";
          hasVisible = true;
        } else {
          tr[i].style.display = "none";
        }
      }
    }

    if (!hasVisible && tr.length > 1) {
      noGamesMsg.innerText = "No teams found matching '" + input.value + "'";
      noGamesMsg.classList.remove("hidden");
    } else {
      if (tr.length > 1) noGamesMsg.classList.add("hidden");
    }
  }

  // -----------------------
  // INIT RENDER
  // -----------------------
  renderSchedule();
</script>

</body>
</html>
